!function(t){function e(e){for(var o,a,i=e[0],l=e[1],c=e[2],d=0,f=[];d<i.length;d++)a=i[d],r[a]&&f.push(r[a][0]),r[a]=0;for(o in l)Object.prototype.hasOwnProperty.call(l,o)&&(t[o]=l[o]);for(u&&u(e);f.length;)f.shift()();return s.push.apply(s,c||[]),n()}function n(){for(var t,e=0;e<s.length;e++){for(var n=s[e],o=!0,i=1;i<n.length;i++){var l=n[i];0!==r[l]&&(o=!1)}o&&(s.splice(e--,1),t=a(a.s=n[0]))}return t}var o={},r={5:0},s=[];function a(e){if(o[e])return o[e].exports;var n=o[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,a),n.l=!0,n.exports}a.m=t,a.c=o,a.d=function(t,e,n){a.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},a.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},a.t=function(t,e){if(1&e&&(t=a(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)a.d(n,o,function(e){return t[e]}.bind(null,o));return n},a.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return a.d(e,"a",e),e},a.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},a.p="";var i=window.webpackJsonp=window.webpackJsonp||[],l=i.push.bind(i);i.push=e,i=i.slice();for(var c=0;c<i.length;c++)e(i[c]);var u=l;s.push([14,0]),n()}({14:function(t,e,n){"use strict";n.r(e),function(t){var e=n(1);t(document).ready(function(){!function(){let n={columns:[],activeObject:null,result:[],routeExport:"/export",key:t("#js-template_keys").html(),exhibition:{name:"exhibition",li:t("#js-template_exhibition").html(),class:".js-column_exhibition"},artwork:{name:"artwork",li:t("#js-template_artwork").html(),class:".js-column_artwork"},park:{name:"park",li:t("#js-template_park").html(),class:".js-column_park"},artist:{name:"artist",li:t("#js-template_artist").html(),class:".js-column_artist"},org:{name:"org",li:t("#js-template_org").html(),class:".js-column_org"}},o={init:function(){r.init()},sendFile:function(e){this.postFile(t(e),t(e).attr("action")).done(function(e){0==e.success?o.iterateErrors(e):1==e.success?(n.columns=e.data,o.iterateKeys(e.data),t("#js-data_ul").html(),o.buildUL(),r.showItem(t("#js-import_data")),t("#data_file").remove(),t("#file_file").clone().attr("id","data_file").addClass("d-none").appendTo("#js-import_data_ul")):(console.log("Don't know what to do!"),console.dir(e))})},sendData:function(e){this.postFile(t(e),t(e).attr("action")).done(function(t){if(0==t.success)o.iterateErrors(t.data);else if(1==t.success){n.result=t;o.iterateResults(n.result.data);r.showModal(`<h3>\n                ${n.activeObject.name.toUpperCase()} IMPORT RESULTS\n              </h3>\n              <ul>\n                <li>Records imported: ${resultCount.success}</li>\n                <li>Records with warnings: ${resultCount.warning}</li>\n                <li>Records with errors: ${resultCount.error}</li>\n              </ul>\n              <h3>EXPORT RESULTS?</h3>`)}else console.log("Don't know what to do!"),console.dir(t)})},sendExport:function(){t("#export_data").val(JSON.stringify(n.result.data)),t(this).closest("form").submit(),r.resetImport()},buildUL:function(){n.columns.forEach(function(e){t("#js-data_ul").append(`<li \n              class="[ row mb-3 align-items-baseline justify-content-center ]"\n             >\n              <div class="js-key">${t(n.key)[0].outerHTML}</div>\n              <div class="[ px-3 ]">\n                <i class="fas fa-arrow-right c-blue--l arrow-import"></i>\n              </div>\n              <div class="js-value"></div>\n            </li>`)}),o.appendNameList(".js-column_key")},appendNameList:function(e){t(e).each(function(e){t(this).attr("name",t(this).attr("name")+"-"+(e+1))})},changeObject:function(e){n.activeObject=n[e],console.log(n.activeObject),t(".js-value").each(function(){t(this).html(n.activeObject.li)}),o.appendNameList(n.activeObject.class)},postFile:function(e,n){console.log("Post route: "+n);let o=new FormData(t(e)[0]);return console.log(o),t.ajax({type:"POST",url:n,processData:!1,contentType:!1,data:o})},iterateErrors:function(t){for(const n in t.data)console.log("ERROR ITEM: "+n),e.a.addErrors(n+": "+t.data[n])},iterateKeys:function(e){for(const o of e)n.key=t(n.key).append(t("<option></option>").attr("value",o).text(o))},iterateResults:function(t){return t.reduce((t,e)=>(1==e.success?t.success++:t.error++,e.warning.length>0&&t.warning++,t),{success:0,warning:0,error:0})},postExport:function(e,n){let o=t("meta[name=csrf-token]").attr("content");return t.ajaxSetup({beforeSend:function(t,e){/^(GET|HEAD|OPTIONS|TRACE)$/i.test(e.type)||this.crossDomain||t.setRequestHeader("X-CSRFToken",o)}}),t.ajax({url:e,type:"POST",contentType:"application/json; charset=utf-8",dataType:"json",data:JSON.stringify(n),processData:!1,success:(t,e,n)=>{console.log("jqXhr: ",jqXhr),console.log("textStatus: ",e),console.log("errorThrown: ",errorThrown)},error:(t,e,n)=>{console.log("jqXhr: ",t),console.log("textStatus: ",e),console.log("errorThrown: ",n)}})},resetImport:function(){n.columns=[],n.activeObject=null,n.result=[],n.key=t("#js-template_keys").html()}},r={init:function(){this.sendFile(),this.sendData(),this.changeObject(),this.closeModal(),this.sendExport()},sendFile:function(){t("#js-post_file").on("click",function(e){e.preventDefault(),o.sendFile(t("#js-form_import_file"))})},sendData:function(){t("#js-post_data").on("click",function(e){e.preventDefault(),o.sendData(t("#js-form_import_data"))})},changeObject:function(){t("#class_object").change(function(e){let n=r.getVal();n&&(o.changeObject(n),t("#js-data_ul").removeClass("d-none"))})},getVal:function(){return t("#class_object").val()},showItem:function(e){t(e).removeClass("d-none")},hideItem:function(e){t(e).addClass("d-none")},showModal:function(e){t("#js-modal_results").modal("show").find("div.modal-body").html(e)},closeModal:function(){t(".modal").on("hide.bs.modal",function(t){r.resetImport()})},sendExport:function(){t("#js-modal-post_export").on("click",function(t){t.preventDefault(),o.sendExport()})},resetImport:function(){this.hideItem("#js-import_data"),t("js-form_import_file").trigger("reset"),t("js-form_import_data").trigger("reset"),t("js-form_export").trigger("reset"),t("#js-data_ul").html(),o.resetImport()}};o.init()}()})}.call(this,n(2))}});
//# sourceMappingURL=import.bundle.js.map